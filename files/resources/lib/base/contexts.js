var convertId=function(a){return"undefined"!=typeof n2id&&n2id[a]?n2id[a]:a},isJSON=function(a){var b=a.getResponseHeader("Content-Type");return b.indexOf("javascript")>=0||b.indexOf("json")>=0},tokenize=function(a){var b=a.split(/_|-|(?=[A-Z])/);return jQuery(b).map(function(a,b){return b.toLowerCase()})},tokenizeHash=function(a){var b=new Array;for(var c in a)b.push({nameTokens:tokenize(c).sort(),value:a[c]});return b},findExactMatch=function(a,b){for(var c=b.join("_"),d=0;d<a.length;d++){var e=a[d];if(e.nameTokens.join("_")==c)return e.value}},matchAllInArray=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(jQuery.inArray(d,a)<0)return!1}return b.length>0},findMatch=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(b(d.nameTokens))return d.value}return null},extractToken=function(a){var b=a.oauth_token,c=a.oauth_token_secret;if(!b&&!c){var d=tokenizeHash(a);b=findMatch(d,function(a,b){return jQuery.inArray("secret",a)>=0?!1:matchAllInArray(a,["token"])}),c=findMatch(d,function(a,b){return matchAllInArray(a,["secret","token"])}),c||(c=findMatch(d,function(a,b){return matchAllInArray(a,["secret"])}))}return{token:b,tokenSecret:c}},appendParamsToUrl=function(a,b,c){var d=jQuery.param(b,c);return d?a.replace(/(\?)|#|$/,function(a){return"?"==a?a+d+"&":"?"+d+(a||"")}):a},createClass=function(){var a=function(){};return function(b,c){var d=function(){this.init.apply(this,arguments)};return d.$super=b,b&&(a.prototype=b.prototype,d.prototype=new a),c&&jQuery.extend(d.prototype,c),d.prototype.init||(d.prototype.init=jQuery.noop),d.prototype.constructor=d,d}}();__ajaxBeforeSend=function(a,b){var c=b.headers;for(var d in c)a.setRequestHeader(d,c[d])};var SecurityContext=createClass(null,{init:function(a){this.settings=a,this.name=a.name},__fireEvent:function(a){var b="on"+a.charAt(0).toUpperCase()+a.slice(1),c=this.settings[b];if(c){var d=jQuery.makeArray(arguments);d=d.slice(1),c.apply(this,d)}},__errorHandler:function(a,b,c){this.__fireEvent("loginError",a,b,c)},__isAuthorizationError:function(a){return jQuery.inArray(a.status,this.settings.authorizationErrorStatusCodes||[])>=0},isLoggedIn:function(){return!1},login:function(){},invoke:function(a,b){var c=b.error,d=this;b.error=function(a,b,e){try{d.__isAuthorizationError(a)?d.__fireEvent("authorizationError",a,b,e):c&&c.apply(this,arguments)}finally{d=null}},a.execute(b)},getUrl:function(a){return a.url}}),SimpleSecurityContext=createClass(SecurityContext,{__getStorageKeyNameBase:function(){return this.name},__getLoginStorageKeyName:function(){return this.__getStorageKeyNameBase()+":login"},__getPasswordStorageKeyName:function(){return this.__getStorageKeyNameBase()+":password"},isLoggedIn:function(){return!!localStorage.getItem(this.__getLoginStorageKeyName())},login:function(a){var b=a.login,c=a.password;localStorage.setItem(this.__getLoginStorageKeyName(),b),localStorage.setItem(this.__getPasswordStorageKeyName(),c)},logout:function(){localStorage.setItem(this.__getLoginStorageKeyName(),""),localStorage.setItem(this.__getPasswordStorageKeyName(),"")},invoke:function(a,b){var c=localStorage.getItem(this.__getLoginStorageKeyName()),d=localStorage.getItem(this.__getPasswordStorageKeyName());if(c){var e="Basic "+jQuery.base64Encode(c+":"+d);b.headers=jQuery.extend({},{Authorization:e},b.headers||{})}SimpleSecurityContext.$super.prototype.invoke.call(this,a,b)}}),OAuthSecurityContext=createClass(SecurityContext,{__authorizeTokenHandler:function(a){var b=OAuth.getParameterMap(a),c=extractToken(b);this.__saveToken(c),this.__fireEvent("loginSuccess",b)},__authorizeToken:function(a,b){var c,d={url:this.settings.serviceProvider.accessTokenURL,type:this.settings.serviceProvider.requestType||"post",dataType:"text",success:jQuery.proxy(this.__authorizeTokenHandler,this),error:jQuery.proxy(this.__errorHandler,this)};b&&(c={oauth_verifier:b}),this.__oAuthAjaxRequest(d,c,a)},__accessToken:function(a){var b=appendParamsToUrl(this.settings.serviceProvider.userAuthorizationURL,{oauth_token:a.token},!0),c=window.open(b),d=jQuery("#"+convertId(this.settings.components.validatePin)),e=d.attr("disabled");d.attr("disabled",!1),d.one("click",jQuery.proxy(function(b){d.attr("disabled",e);var f=jQuery("#"+convertId(this.settings.components.pinInput));if(c)try{c.close()}finally{c=null}this.__authorizeToken(a,f.val())},this))},__requestTokenHandler:function(a){var b=OAuth.getParameterMap(a),c=extractToken(b);this.__accessToken(c)},__requestToken:function(){this.__oAuthAjaxRequest({url:this.settings.serviceProvider.requestTokenURL,type:this.settings.serviceProvider.requestType||"post",data:jQuery.extend({},this.settings.requestTokenData,{oauth_token_callback:"oob"}),dataType:"text",success:jQuery.proxy(this.__requestTokenHandler,this),error:jQuery.proxy(this.__errorHandler,this)})},__getOAuthAjaxRequestSettings:function(a,b,c,d){var e=OAuth.getParameterList(a.data||{}),f=OAuth.getParameterList(b||{}),g=jQuery.merge(jQuery.merge([],e),f),h={action:a.url,method:a.type||"get",parameters:g},i=e.length,j=c?jQuery.extend({},this.settings,c):this.settings;OAuth.completeRequest(h,j);var k=jQuery.extend({},a);if(d)k.data=OAuth.getParameterMap(g);else{var l=OAuth.getAuthorizationHeader("",g.slice(i)),m={Authorization:l,"Content-Type":"application/x-www-form-urlencoded"};k.headers?k.headers=jQuery.extend({},k.headers,m):k.headers=m,k.beforeSend=__ajaxBeforeSend}return k},__oAuthAjaxRequest:function(a,b,c){var d=this.__getOAuthAjaxRequestSettings(a,b,c,!1);jQuery.ajax(d)},getToken:function(){var a=localStorage.getItem(this.__getTokenStorageKeyName()),b=localStorage.getItem(this.__getTokenSecretStorageKeyName());return a&&b?{token:a,tokenSecret:b}:null},__getStorageKeyNameBase:function(){return this.settings.serviceProvider.requestTokenURL},__getTokenStorageKeyName:function(){return this.__getStorageKeyNameBase()+":token"},__getTokenSecretStorageKeyName:function(){return this.__getStorageKeyNameBase()+":tokenSecret"},__saveToken:function(a){localStorage.setItem(this.__getTokenStorageKeyName(),a.token),localStorage.setItem(this.__getTokenSecretStorageKeyName(),a.tokenSecret)},clearToken:function(){this.__saveToken({})},isLoggedIn:function(){return!jQuery.isEmptyObject(this.getToken())},__login:function(){this.__requestToken.apply(this,arguments)},login:function(){this.clearToken(),this.__login.apply(this,arguments)},getUrl:function(a){var b=a.data;return b||(b=a.data={}),this.isLoggedIn()&&(a=this.__getOAuthAjaxRequestSettings(a,{},this.getToken(),!0)),appendParamsToUrl(a.url,a.data,a.traditional)},invoke:function(a,b){var c=this.__getOAuthAjaxRequestSettings(b,{},this.getToken());OAuthSecurityContext.$super.prototype.invoke.call(this,a,c)}}),XAuthSecurityContext=createClass(OAuthSecurityContext,{__successHandler:function(a,b,c){var d;d=isJSON(c)?"object"===jQuery.type(a)?a:jQuery.parseJSON(a):OAuth.getParameterMap(a);var e=extractToken(d);this.__saveToken(e),this.__fireEvent("loginSuccess",d)},__requestToken:function(a){"function"==typeof a&&(a=a.call(this));var b={type:this.settings.serviceProvider.requestType||"post",dataType:this.settings.serviceProvider.responseDataType||"text",url:this.settings.serviceProvider.requestTokenURL,success:jQuery.proxy(this.__successHandler,this),error:jQuery.proxy(this.__errorHandler,this),data:a};jQuery.ajax(this.__getOAuthAjaxRequestSettings(b))}}),OAuth2UsernamePasswordSecurityContext=createClass(SecurityContext,{__getStorageKeyNameBase:function(){return this.settings.requestTokenURL},__getAccessTokenStorageKeyName:function(){return this.__getStorageKeyNameBase()+":accessToken"},__getTokenInstanceUrlStorageKeyName:function(){return this.__getStorageKeyNameBase()+":instanceUrl"},__saveToken:function(a){localStorage.setItem(this.__getAccessTokenStorageKeyName(),a.accessToken),localStorage.setItem(this.__getTokenInstanceUrlStorageKeyName(),a.instanceUrl)},__requestTokenHandler:function(a){this.__saveToken({accessToken:a.access_token,instanceUrl:a.instance_url}),this.__fireEvent("loginSuccess",a)},clearToken:function(){this.__saveToken({})},getToken:function(){var a=localStorage.getItem(this.__getAccessTokenStorageKeyName()),b=localStorage.getItem(this.__getTokenInstanceUrlStorageKeyName());return a&&b?{accessToken:a,instanceUrl:b}:null},isLoggedIn:function(){return!!this.getToken()},login:function(){var a=this.settings.requestParameters||{};"function"==typeof a&&(a=a.call(this));var b={grant_type:"password",client_id:this.settings.clientId,client_secret:this.settings.clientSecret};jQuery.extend(b,a),jQuery.ajax({type:"post",dataType:"json",data:b,url:this.settings.requestTokenURL,success:jQuery.proxy(this.__requestTokenHandler,this),error:jQuery.proxy(this.__errorHandler,this)})},invoke:function(a,b){var c=jQuery.extend({},b),d=this.getToken();d&&(c.url=c.url.replace(/^https?\:\/\/[^\/]+/,d.instanceUrl),c.headers=jQuery.extend({},c.headers,{Authorization:"OAuth "+d.accessToken}),c.beforeSend=__ajaxBeforeSend),OAuth2UsernamePasswordSecurityContext.$super.prototype.invoke.call(this,a,c)}});