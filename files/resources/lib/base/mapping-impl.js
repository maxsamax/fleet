function __init_mapping(){"use strict";function a(a){if(a){showSpinner();try{for(var b=0;b<a.directions.length;b++)new d(a.directions[b]).process();Apperyio.refreshFacadeScreenFormElements(Apperyio.CurrentScreen)}finally{hideSpinner()}}}var b=window.__transformation||function(){function a(a,b){this.sourceFunc=a,this.targetFunc=b}return a.prototype.transform=function(a,b){var c,d=a,e=[];if(b&&(e[1]=b),_.isFunction(this.sourceFunc)){e[0]=_.deepClone(d);try{c=this.sourceFunc.apply(this,e)}catch(f){}_.isUndefined(c)||(d=c,c=void 0)}if(_.isFunction(this.targetFunc)){e[0]=_.deepClone(d);try{c=this.targetFunc.apply(this,e)}catch(f){}_.isUndefined(c)||(d=c,c=void 0)}return d},a}(),c=window.__entry||function(){function a(a,b){this.unit=a,this.path=b}return a.prototype.getValue=function(){var a;return a="UI"===this.unit.from_type?f.get(this.path):e.get(this.path,_.deepClone(this.unit.srcData))},a.prototype.setValue=function(a,b){"UI"===this.unit.to_type?f.set(this.path,a,b):this.unit.dstData=e.merge(this.path,this.unit.dstData,a,b)},a}(),d=window.__mapping_unit||function(){function a(a){this.from_name=a.from_name,this.from_type=a.from_type,this.to_name=a.to_name,this.to_type=a.to_type,this.to_default=a.to_default,this.mappings=a.mappings,this.srcData=null,this.dstData=null}var d=["SERVICE_REQUEST","SERVICE_RESPONSE","SERVICE_ERROR"],f=["SESSION_STORAGE","LOCAL_STORAGE","VARIABLE_STORAGE"];return a.prototype.process=function(){this.beforeProcessMappings(),this.processMappings(),this.afterProcessMappings()},a.prototype.beforeProcessMappings=function(){"UI"===this.from_type?"UI"===this.to_type?Apperyio.UIHandler.discardGeneratedComponents(this):(this.to_name&&this.to_type&&(this.dstData=_.deepClone(this.__loadParticipantData(this.to_name,this.to_type))),this.to_default&&$.isEmptyObject(this.dstData)&&(this.dstData=this.__applyDefaultValues(this.dstData,this.to_default))):(this.from_name&&this.from_type&&(this.srcData=_.deepClone(this.__loadParticipantData(this.from_name,this.from_type))),"UI"===this.to_type?Apperyio.UIHandler.discardGeneratedComponents(this):(this.to_name&&this.to_type&&(this.dstData=_.deepClone(this.__loadParticipantData(this.to_name,this.to_type))),this.to_default&&$.isEmptyObject(this.dstData)&&(this.dstData=this.__applyDefaultValues(this.dstData,this.to_default))))},a.prototype.processMappings=function(){for(var a=0;a<this.mappings.length;a++){var d=new c(this,this.mappings[a].source),f=new c(this,this.mappings[a].target),g=new b(this.mappings[a].source_transformation,this.mappings[a].target_transformation);if(f.path)if(d.path){var h=d.path.match(/\[i\]/g);h=h?h.length:0;var i=f.path.match(/\[i\]/g);i=i?i.length:0,"UI"!==this.from_type&&"UI"!==this.to_type&&h!==i,f.setValue(d.getValue(),g)}else this.dstData=e.merge(f.path,this.dstData,e.get(f.path,this.dstData),g);else this.srcData=e.merge(d.path,this.srcData,e.get(d.path,this.srcData),g)}},a.prototype.afterProcessMappings=function(){"UI"===this.from_type?"UI"===this.to_type?(Apperyio.UIHandler.showGeneratedComponents(this),Apperyio.UIHandler.showStaticContainerComponents(this)):this.to_name&&this.to_type&&this.__saveParticipantData(this.to_name,this.to_type,this.dstData):"UI"===this.to_type?(Apperyio.UIHandler.showGeneratedComponents(this),Apperyio.UIHandler.showStaticContainerComponents(this)):this.to_name&&this.to_type&&this.__saveParticipantData(this.to_name,this.to_type,this.dstData)},a.prototype.__saveParticipantData=function(a,b,c){if(_.isUndefined(a))throw new Error("Can't save data by undefined name");if(_.isUndefined(b))throw new Error("Can't save data by undefined type");if(-1!==d.indexOf(b)){if(!Apperyio.datasources[a])throw new Error("Datasource '"+a+"' not found");"SERVICE_REQUEST"===b?Apperyio.datasources[a].request=c:"SERVICE_RESPONSE"===b?Apperyio.datasources[a].response=c:"SERVICE_ERROR"===b&&(Apperyio.datasources[a].error=c)}else{if(-1===f.indexOf(b))throw new Error("Unsupported data type "+b);if(!Apperyio.storage||!Apperyio.storage[a])throw new Error("Storage '"+a+"' not found");Apperyio.storage[a].set(c)}},a.prototype.__loadParticipantData=function(a,b){if(_.isUndefined(a))throw new Error("Can't load data by undefined name");if(_.isUndefined(b))throw new Error("Can't load data by undefined type");if(-1!==f.indexOf(b)){if(!Apperyio.storage||!Apperyio.storage[a])throw new Error("Storage '"+a+"' not found");return Apperyio.storage[a].get()}if(-1===d.indexOf(b))throw new Error("Unsupported data type "+b);if(!Apperyio.datasources[a])throw new Error("Datasource '"+a+"' not found");return"SERVICE_REQUEST"===b?Apperyio.datasources[a].request:"SERVICE_RESPONSE"===b?Apperyio.datasources[a].response:"SERVICE_ERROR"===b?Apperyio.datasources[a].error:void 0},a.prototype.__applyDefaultValues=function(b,c){if(void 0===c)return b;if(!_.isTrueObject(c))throw new Error("Default values argument must be an object");var d;for(var e in c)c.hasOwnProperty(e)&&(d=d||{},_.isTrueObject(c[e])?d[e]=a.prototype.__applyDefaultValues(b&&_.isTrueObject(b[e])?b[e]:{},c[e]):d[e]=b&&void 0!==b[e]?b[e]:c[e]);return void 0!==d?d:b},a.prototype.DATASOURCE_GROUP=d,a.prototype.WEB_STORAGE_GROUP=f,a}(),e=window.__mep||function(){return{get:function(a,b){if(void 0===a)throw new Error("Path is undefined");return"$"===a?b:this._get(this.validateAndPreparePath(a),b)},_get:function(a,b){if(0===a.length)return b;if(void 0!==b&&null!==b){var c,d=_.head(a),e=_.tail(a),f=this.getPathNodeType(d),g=f===this.NODE_TYPES.INDEX||f===this.NODE_TYPES.ALL,h=f===this.NODE_TYPES.PROPERTY,i=f===this.NODE_TYPES.ALL,j=f===this.NODE_TYPES.INDEX||f===this.NODE_TYPES.PROPERTY;if(_.isArray(b)&&h)throw new Error("Attempt to access Array by property name : "+d);if(_.isTrueObject(b)&&g)throw new Error("Attempt to access Object by index: "+d);if(i){for(var k=0;k<b.length;k++)void 0!==a[1]&&(a[0]=k.toString(),b[k]=this._get(a,b));return b}if(j)return f===this.NODE_TYPES.INDEX?c=parseInt(d):f===this.NODE_TYPES.PROPERTY&&(c=this.getPropName(d)),this._get(e,b?b[c]:b);throw new Error("Unsupported node type "+f)}},merge:function(a,c,d,e){if(_.isUndefined(e)&&(e=new b),"$"===a){var f;return _.isArray(d)?(f=[],_.each(d,function(a,b){f[b]=e.transform(a)})):f=e.transform(d),f}return this._merge(this.validateAndPreparePath(a),c,d,e)},_merge:function(a,b,c,d){function e(a,b,c){var d=0!==a.length,e=_.isTrueObject(b)&&_.isTrueObject(c),f=_.isArray(b)&&_.isArray(c);return d&&(e||f)}var f;if(0===a.length)return f=d.transform(c);var g,h,i=_.head(a),j=_.tail(a),k=this.getPathNodeType(i),l=k===this.NODE_TYPES.INDEX||k===this.NODE_TYPES.ALL,m=k===this.NODE_TYPES.PROPERTY,n=k===this.NODE_TYPES.ALL,o=k===this.NODE_TYPES.INDEX||k===this.NODE_TYPES.PROPERTY;if(l)h=_.isArray(b)?b:[];else{if(!m)throw new Error("Unsupported node type "+k);h="[object Object]"===Object.prototype.toString.call(b)?b:{}}if(n){if(!_.isArray(c))throw new Error(JSON.stringify(c)+" expected to be an Array");for(var p=[],q=0;q<c.length;q++)f=this._merge(j,h[q],c[q],d),e(j,h[q],f)?p[q]=_.extend(h[q],f):p[q]=f;return p}if(o)return k===this.NODE_TYPES.INDEX?g=parseInt(i):k===this.NODE_TYPES.PROPERTY&&(g=this.getPropName(i)),f=this._merge(j,h[g],c,d),e(j,h[g],f)?_.extend(h[g],f):h[g]=f,h;throw new Error("Unsupported node type "+k)},getPathNodeType:function(a){return"i"===a?this.NODE_TYPES.ALL:a.indexOf("'")<=-1?this.NODE_TYPES.INDEX:this.NODE_TYPES.PROPERTY},getPropName:function(a){return a.replace(/'/g,"")},validateAndPreparePath:function(a){if(!e.validatePath(a))throw new Error("Mapping Expression is incorrect");var b=a.substring(1,a.length).split("][");return b[0]=b[0].replace("[",""),b[b.length-1]=b[b.length-1].replace("]",""),b},validatePath:function(a){return/^\$(\[(i|\d+|'.+')\])*$/.test(a)},NODE_TYPES:{ALL:"all",INDEX:"index",PROPERTY:"prop"}}}(),f=window.__uihandler||function(){function a(a){return a.source&&-1===a.source.lastIndexOf("[i]",a.source.length-3)&&a.target&&-1===a.target.indexOf(":")?a.target.match(/\['([0-9a-zA-Z_-]+)'\]/g):[]}function b(a){return d(a,!1)}function c(a){return d(a,!0)}function d(a,b){if(a.source&&a.target){var c=a.source.match(/\[i\]/g);return c=c?c.length:0,0===c?[]:(c>1&&b&&(c=1),_.first(a.target.match(/\['([0-9a-zA-Z_:-]+)'\]/g),c))}return[]}function f(a){return a.replace(/(\[')|('\])|(\:\w+)/g,"")}function g(a,b){return _.chain(a).map(function(a){var c=a.jquery?a.attr("dsid"):a.getAttribute("dsid"),d=$("#"+b+" [dsrefid='"+c+"']");return d.length>0?g(d,b):a}).flatten().value()}var h=function(){};return h.prototype.hideTemplateComponents=function(c){for(var d=0,e=c.directions.length;e>d;d++){var g=c.directions[d];if("UI"===g.to_type)for(var h=_.chain(g.mappings).map(b).flatten().compact().uniq().map(f).value(),i=_.chain(g.mappings).map(a).flatten().compact().uniq().map(f).value(),j=_.union(h,i),k=0,l=j.length;l>k;k++){var m=$("#"+g.to_name+" [dsid='"+j[k]+"']"),n=$a.c15r(m,"wrapper");n.attr("data-appery-tpl","true")}}},h.prototype.discardGeneratedComponents=function(a){"UI"===a.to_type&&_.isArray(a.mappings)&&_.chain(a.mappings).map(c).flatten().compact().uniq().map(f).each(function(b){$("#"+a.to_name+" [dsrefid='"+b+"']").each(function(a,b){Apperyio.c15r(b,"wrapper").remove()})})},h.prototype.showGeneratedComponents=function(a){"UI"===a.to_type&&_.isArray(a.mappings)&&(_.chain(a.mappings).map(b).flatten().compact().map(f).uniq().map(function(b){var c=$("#"+a.to_name+" [dsid='"+b+"']");if(0===c.length)return[];var d=g(c,a.to_name);return c.is(d)?[]:d}).flatten().compact().each(function(a){var b=$a.c15r(a,"wrapper");b.removeAttr("data-appery-tpl")}),Apperyio.refreshFacadeScreenFormElements(a.to_name))},h.prototype.showStaticContainerComponents=function(b){if("UI"===b.to_type&&_.isArray(b.mappings))for(var c=_.chain(b.mappings).map(a).flatten().compact().uniq().map(f).value(),d=0,e=c.length;e>d;d++){var g=$("#"+b.to_name+" [dsid='"+c[d]+"']"),h=$a.c15r(g,"wrapper");h.removeAttr("data-appery-tpl")}},h.prototype.resolveGeneratedComponent=function(a,b){if(!_.isElement(b))return $("[dsid='"+a+"']");var c,d=$(b),e="[_idx]";if(d.is(e)){var f="[name='"+a+"']",g=d;if(g.is(f))c=d;else{for(var h=g.closest("[dsrefid]").find(f+e);0===h.size()&&(g=g.parent().closest("[dsrefid]"),0!==g.size());)h=g.eq(0).find(f+e).eq(0);0!==h.size()&&(c=h.eq(0))}}return c||(c=d.closest("[data-role='page']").find("[dsid='"+a+"']")),c},h.prototype.__set=function(a,b,c,d,e){if(0!==b.length&&b[0]){var f,g,h,i,j=b[0].replace(/'/g,"").split(":"),k=j[0],l=j[1],m="[dsid='"+k+d+"']:first",n=$(m,a),o=$a.c15r(n,"wrapper");if(0!==n.length)if($.isArray(c)&&"true"===o.attr("data-appery-tpl"))for(var p=0;p<c.length;p++)f="[dsid='"+k+d+"_"+p+"']",g=$(f,a),0===g.length&&(h=$a.c15r(n,"clone",p).insertBefore(o),g=$a.c15r(h,"unwrapper"),$a.c15r(g,"set_changed")),l?(i=e.transform(c[p],g),$a.c15r(g,"set",l,i)):1===b.length?e.transform(c[p],g):this.__set(g,_.tail(b),c[p],d+"_"+p,e);else l?(i=e.transform(c,n),Apperyio.c15r(n,"set",l,i)):e.transform(c,n),$a.c15r(n,"set_changed")}},h.prototype.set=function(a,b,c){var d=$("#"+Apperyio.CurrentScreen);d&&-1!==d.attr("class").indexOf("detail-content")&&(d=d.parents("[data-role='page']")),this.__set(d,e.validateAndPreparePath(a),b,"",c)},h.prototype.__get=function(a,b){if(0!==b.length&&b[0]){var c=b[0].replace(/'/g,"").split(":"),d=c[0],e=c[1];return Apperyio.c15r($("[dsid='"+d+"']",a),"get",e)}},h.prototype.get=function(a){return this.__get($("#"+Apperyio.CurrentScreen),e.validateAndPreparePath(a))},new h}();Apperyio.processMappingAction=a,Apperyio.UIHandler=f,Apperyio.MEP=e,Apperyio.__tests__=Apperyio.__tests__||{},Apperyio.__tests__.Transformation=b,Apperyio.__tests__.Entry=c,Apperyio.__tests__.MappingUnit=d,Apperyio.__tests__.MEP=e,Apperyio.__tests__.processMappingAction=a,Apperyio.__tests__.UIHandler=f,Apperyio.__tests__.loadData=d.prototype.__loadParticipantData,Apperyio.__tests__.saveData=d.prototype.__saveParticipantData}__init_mapping();