function initializeTrailerStatusMap(){function a(a){$(".TrailerStatusButtons").removeClass("active"),$(a.target).addClass("active")}Appery("trailerMapOverlay").hide(),trailerStatusMap=Apperyio("trailerStatusMapComponent").gmap,trailerStatusMap?(trailerStatusMapDeferred.resolve(),updateGeoFencesDataWithDataSource(trailerStatusGeoFences,TSGFmarkers,TSGFcircles)):setTrailerStatusMapInitDelay(),$(".TrailerStatusButtons").off("click",a).on("click",a)}function setTrailerStatusMapInitDelay(){setTimeout(initializeTrailerStatusMap,50)}function trailerStatusUpdateCurrent(){CollapseAllTrailerStatusButtons();var a=getCurrentTrailer();return Appery("trailerMapOverlay").hide(),a&&a.Location?(currentDirection.execute(),void(previousMapZoom&&trailerStatusMap.setZoom(previousMapZoom))):(trailerStatusMap.setZoom(2),void Appery("trailerMapOverlay").show())}function updateTrailerStatusLabels(){var a=getCurrentTrailer();a&&($("#TrailerStatus_WFHeader_TS_title_label").text(a.Information.name),Appery("TrailerImage").attr("src",MapTrailerTypeToImagePath(a.Information.type)),Appery("OdometerLabal").text(a.Status.odometer),Appery("HoursOfUseLabel2").text(a.Status.hoursOfUse),Appery("NotesLabel").text(a.Information.notes))}function showOnlyCurrentStatusMarkerPin(){return void updateCurrentDirection()}function trailerStatusMap_setCenter_wrapper(a){var b=Apperyio("trailerStatusMapComponent");b.options.latitude=a.lat(),b.options.longitude=a.lng(),trailerStatusMap.setCenter(a)}function dropTrailerStatusMarkerPins(){var a=!0;for(deleteMapMarkers(trailerStatusMapMarkers,trailerStatusMap),trailerStatusMapBounds=new google.maps.LatLngBounds,i=0;i<trackingUnitHistory.length;i++){var b=dropOneMarker(i);0!=trackingUnitHistory[i].lat&&0!=trackingUnitHistory[i]["long"]?(a=!1,trailerStatusMapBounds.extend(b)):trailerStatusMapMarkers[i].setMap(null)}var c=function(){a?fitBoundsToUSZip(trailerStatusMap):(trailerStatusMap.fitBounds(trailerStatusMapBounds),trailerStatusMap.getZoom()>16&&trailerStatusMap.setZoom(16)),trailerStatusMap.panBy(1,1)};setTimeout(c,0),Apperyio("TrailerStatusSlideyBar").attr("max",trackingUnitHistory.length-1),Apperyio("TrailerStatusSlideyBar").val(trackingUnitHistory.length-1).slider("refresh")}function dropOneMarker(a,b){var c=new google.maps.LatLng(trackingUnitHistory[a].lat,trackingUnitHistory[a]["long"]),d="";d=OldMapDeviceStateToMapMarkers(trackingUnitHistory[a].deviceState);var e=new google.maps.Marker({position:c,map:trailerStatusMap,icon:d,opacity:b||1});return 0===a&&(e.setAnimation(google.maps.Animation.BOUNCE),lastTrackingUnitBouncyMarkerIndex=0),trailerStatusMapMarkers.push(e),c}function updateHistoryStatusGrid(a){Apperyio("noGPShistoryLabel").hide(),historyInfoWindow.close();var b=new Date(trackingUnitHistory[lastTrackingUnitBouncyMarkerIndex].reportTime);if(Apperyio("StatusTimeLabel").text(b.toLocaleString()),Apperyio("MovingStatusLabel").text(MapMovingText(trackingUnitHistory[lastTrackingUnitBouncyMarkerIndex].deviceState)),Apperyio("ConcatenatedTrailerStatusLabel").text("Trailer was "+MapMovingText(trackingUnitHistory[lastTrackingUnitBouncyMarkerIndex].deviceState,!0)+" at "+b.toLocaleString()),0==trackingUnitHistory[lastTrackingUnitBouncyMarkerIndex].lat&&0==trackingUnitHistory[lastTrackingUnitBouncyMarkerIndex]["long"]&&(Apperyio("noGPShistoryLabel").show(),a)){var c=trailerStatusMap.getCenter();historyInfoWindow.setPosition(c),google.maps.event.addListener(historyInfoWindow,"domready",function(){var a=$(".noGPSInfo").parents(".gm-style-iw");a.prev();a.parent().addClass("noGPSInfoWrapper"),$(".noGPSInfoWrapper").children("div:first-child").children("div:nth-child(3)").hide(),$(".noGPSInfoWrapper").children("div:first-child").children("div:first-child").hide()}),historyInfoWindow.open(trailerStatusMap)}}function CollapseAllTrailerStatusButtons(){historyInfoWindow.close(),Apperyio("HistoryViewGrid").hide(),Apperyio("HistoryViewSlideyGrid").hide(),Apperyio("TrailerStatusMapGrid").show(),Apperyio("AlertsViewGrid").hide(),Apperyio("MaintenanceViewGrid").hide(),HistoryViewGridVisible=!1,AlertsviewGridVisible=!1,MaintenanceViewGridVisible=!1,$(".ui-btn.ui-btn-a:focus").blur()}function ShowHistoryViewGrid(){Apperyio("HistoryViewGrid").show(),Apperyio("HistoryViewSlideyGrid").show(),Apperyio("TrailerStatusMapGrid").show(),Apperyio("AlertsViewGrid").hide(),Apperyio("MaintenanceViewGrid").hide(),HistoryViewGridVisible=!0,AlertsViewGridVisible=!1,MaintenanceViewGridVisible=!1}function ShowAlertsViewGrid(){Apperyio("HistoryViewGrid").hide(),Apperyio("HistoryViewSlideyGrid").hide(),Apperyio("TrailerStatusMapGrid").hide(),Apperyio("AlertsViewGrid").show(),Apperyio("MaintenanceViewGrid").hide(),HistoryViewGridVisible=!1,AlertsViewGridVisible=!0,MaintenanceViewGridVisible=!1}function ShowMaintenanceViewGrid(){Apperyio("HistoryViewGrid").hide(),Apperyio("HistoryViewSlideyGrid").hide(),Apperyio("TrailerStatusMapGrid").hide(),Apperyio("AlertsViewGrid").hide(),Apperyio("MaintenanceViewGrid").show(),HistoryViewGridVisible=!1,AlertsViewGridVisible=!1,MaintenanceViewGridVisible=!0}function updateCurrentDirection(){var a=!0;updateTrailerStatusLabels();var b=3,c=.3,d=1;switch($(".FastTrackButton").removeClass("moving"),enableFastTrack=!1,deleteMapMarkers(trailerStatusMapMarkers,trailerStatusMap),trackingUnitHistory[0].deviceState){case"moving":$(".FastTrackButton").addClass("moving"),enableFastTrack=!0;break;case"fast track":b=6,c=.15;break;case"stationary":case"storage":b=1}b>trackingUnitHistory.length&&(b=trackingUnitHistory.length),trailerStatusMapBounds=new google.maps.LatLngBounds;for(var e=0;b>e;e++){var f=dropOneMarker(e,d);if(0!=trackingUnitHistory[e].lat&&0!=trackingUnitHistory[e]["long"]){if(trailerStatusMapBounds.extend(f),a)var g=e;var a=!1}else trailerStatusMapMarkers[e].setMap(null);d-=c}var h=function(){a?fitBoundsToUSZip(trailerStatusMap):(trailerStatusMap.fitBounds(trailerStatusMapBounds),trailerStatusMap.getZoom()>16&&trailerStatusMap.setZoom(16)),trailerStatusMap.panBy(1,1)};if(setTimeout(h,0),g>=0){var i=trailerStatusMapMarkers[g],j=new Date(trackingUnitHistory[g].reportTime),k=new google.maps.InfoWindow({content:'<div id="lastKnownLocationInfo"><p>Last Known Location,</p><p>'+j.toLocaleString()+"</p></div>"});google.maps.event.addListener(k,"domready",function(){var a=$("#lastKnownLocationInfo").parents(".gm-style-iw"),b=a.prev();a.parent().addClass("lastKnownLocationWindow"),b.children(":nth-child(2)").css({display:"none"}),b.children(":nth-child(4)").css({display:"none"})}),k.open(trailerStatusMap,i)}}function turnOnFastTrackMode(){enableFastTrack&&Appery.navigateTo("FastTrackDialog")}function fastTrackMode(){localStorage.deviceCommand="goToFastTrack",fastTrackCommand.execute()}function showErrorPopup(a){Appery("TrailerStatusDatePopup").text(a).show(),setTimeout(function(){Appery("TrailerStatusDatePopup").hide("close")},1e4)}function updateDateControls(){hasChanged=!1;var a=new Date((new Date).getTime()-432e5),b=new Date,c=getCurrentTrailer().Status.reportTime;Date.parse(a)>c&&(b=new Date(c),a=new Date(c-432e5)),localStorage.setItem("thisStartDateTime",Date.parse(a)),localStorage.setItem("thisEndDateTime",Date.parse(b)),prevStartDate=$.datepicker.formatDate(Appery("StartDate").datepicker_dataPickerOptions.dateFormat,a),prevStartTime=a.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),prevEndDate=$.datepicker.formatDate(Appery("EndDate").datepicker_dataPickerOptions.dateFormat,b),prevEndTime=b.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),Appery("StartDate").setProperty("defaultDateValue",prevStartDate),Appery("EndDate").setProperty("defaultDateValue",prevEndDate),Appery("StartTime").val(prevStartTime),Appery("EndTime").val(prevEndTime)}function validationDate(){if(!hasChanged){var a=new Date;localStorage.setItem("thisEndDateTime",Date.parse(a)),Appery("EndDate").setProperty("defaultDateValue",$.datepicker.formatDate(Appery("EndDate").datepicker_dataPickerOptions.dateFormat,a)),Appery("EndTime").val(a.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"))}var b=Appery("StartDate").datepicker_dataPickerOptions.defaultDate,c=Appery("StartTime").val(),d=Appery("EndDate").datepicker_dataPickerOptions.defaultDate,e=Appery("EndTime").val(),f=(localStorage.getItem("thisStartDateTime"),localStorage.getItem("thisEndDateTime"),Date.parse(b+" "+c)),g=Date.parse(d+" "+e),h=(g-f)/12096e5;if(b&&c&&d&&e){if(h>1){showErrorPopup("Time range should be less than 14 days."),f=g-12096e5;var i=$.datepicker.formatDate(Appery("StartDate").datepicker_dataPickerOptions.dateFormat,new Date(f)),j=new Date(f).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");Appery("StartDate").setProperty("defaultDateValue",i),Appery("StartTime").val(j)}0>h&&showErrorPopup("Start date should not be greater than end date."),g>=f&&g>=f&&h>0&&(localStorage.setItem("thisStartDateTime",f),localStorage.setItem("thisEndDateTime",g),trackUnit.execute())}else showErrorPopup("Please fill all fields")}var HistoryViewGridVisible=!1,AlertsViewGridVisible=!1,MaintenanceViewGridVisible=!1,enableFastTrack=!1,currentDirectionTimeout,trackingUnitHistory=[],lastTrackingUnitBouncyMarkerIndex,trailerStatusMap,trailerStatusMapBounds=new google.maps.LatLngBounds,trailerStatusMapMarkers=[],TSGFmarkers=[],TSGFcircles=[],trailerStatusMapDeferred=$.Deferred(),trailerStatusMapReady=trailerStatusMapDeferred.promise(),hasChanged=!1,historyInfoWindow=new google.maps.InfoWindow({content:'<div class="noGPSInfo"><p style="color: red">GPS data not available</p></div>'}),trailerInformationType;