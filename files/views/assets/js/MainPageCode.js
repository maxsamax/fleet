function MainPage_load(){initializeMainPageMap()}function initializeMainPageMap(){MainPageMap=Apperyio("MainPageMapComponent").gmap,MainPageMap?mapDeferred.resolve():setMainPageMapInitDelay()}function setMainPageMapInitDelay(){setTimeout(initializeMainPageMap,50)}function dropMainPageMarkerPins(){removeInfoWindows();var a=function(a){if(AllUnitsLatestHistory[a].Location){var b=new Date(AllUnitsLatestHistory[a].Status.reportTime);if(!AllUnitsLatestHistory[a].Location.lat&&!AllUnitsLatestHistory[a].Location["long"])return void(1==AllUnitsLatestHistory.lenght&&(fitBoundsToUSZip(MainPageMap,""),noGPS=!0));var c=new google.maps.LatLng(AllUnitsLatestHistory[a].Location.lat,AllUnitsLatestHistory[a].Location["long"]),d="";d=MapDeviceStateToMapMarkers(AllUnitsLatestHistory[a].Status.deviceState);var e=new google.maps.Marker({position:c,map:MainPageMap,icon:d,title:AllUnitsLatestHistory[a].Information.name+"\n"+MapDeviceStateToUserText(AllUnitsLatestHistory[a].Status.deviceState)+"\n"+b.toLocaleString()}),f=function(){return function(){MainPageMapMarkers.push(e),function(){var a=MainPageMapBounds.extend(c);MainPageMap.fitBounds(a);var b=a.getCenter(),d=Apperyio("MainPageMapComponent");d.options.latitude=b.lat(),d.options.longitude=b.lng(),lazySetZoom()}()}};e.addListener("click",function(){localStorage.setItem("currentDeviceSn",AllUnitsLatestHistory[a].Information.whrztSn),Apperyio.navigateTo("TrailerStatus")}),setTimeout(f(),1)}};for(i=0;i<AllUnitsLatestHistory.length;i++)a(i)}function removeInfoWindows(){for(var a=0;a<MVInfoWindows.length;a++)MVInfoWindows[a].setMap(null)}function ShowAllTrailers(){_.each(MainPageMapMarkers,function(a){var b=MainPageMapBounds.extend(a.position);MainPageMap.fitBounds(b),lazySetZoom()})}function filterInit(){$(".MainPageListClass").filterable("option","filterCallback",function(a,b){var c=!1;if(MainPageMapMarkers[a]&&MainPageMapMarkers[a].setMap(MainPageMap),a==AllUnitsLatestHistory.length)return!0;var d=AllUnitsLatestHistory[a];if(b){var e=new Date(d.Status.reportTime).toLocaleString();-1===d.Information.name.toLowerCase().indexOf(b)&&-1===d.Status.deviceState.toLowerCase().indexOf(b)&&-1===e.indexOf(b)&&(c=!0,MainPageMapMarkers[a].setMap(null))}return c})}function updateGeoFencesDataWithDataSource(a,b,c){for(var d=0;d<b.length;d++)b[d].setMap(null);for(b=[],d=0;d<c.length;d++)c[d].setMap(null);c=[],a&&a.execute()}function refreshGeoFencesForMap(a,b,c,d){_.each(a,function(a){var e=new google.maps.LatLng(a.lat,a["long"]),f=new google.maps.Marker({position:e,map:b,title:a.name+":\n"+a.type,animation:google.maps.Animation.DROP,zIndex:2});c.push(f);var g=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:b,center:e,editable:!1,radius:+a.radius||1e3});d.push(g),(noGPS||!MainPageMapMarkers.length)&&!function(){var a=MainPageMapBounds.extend(e);MainPageMap.fitBounds(a);var b=a.getCenter(),c=Apperyio("MainPageMapComponent");c.options.latitude=b.lat(),c.options.longitude=b.lng(),lazySetZoom()}()}),noGPS=!1}var AllUnitsLatestHistory=[],AllUnitsLatestHistoryIndex=AllUnitsDateIndex=AllUnitsStateIndex=0,AllUnitsUpdateTimeout,MainPageMap,MainPageMapBounds=new google.maps.LatLngBounds,previousMapZoom,MainPageMapMarkers=[],MVGFmarkers=[],MVGFcircles=[],MVInfoWindows=[],mapDeferred=$.Deferred(),mapReady=mapDeferred.promise(),noGPS,lazySetZoom=_.debounce(function(){MainPageMap.getZoom()>12&&MainPageMap.setZoom(12)},300);