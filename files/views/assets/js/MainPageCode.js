function MainPage_load(){initializeMainPageMap()}function initializeMainPageMap(){MainPageMap=Apperyio("MainPageMapComponent").gmap,MainPageMap?mapDeferred.resolve():setMainPageMapInitDelay()}function setMainPageMapInitDelay(){setTimeout(initializeMainPageMap,50)}function dropMainPageMarkerPins(){removeInfoWindows();var a=0,b=function(b){if(AllUnitsLatestHistory[b].Location){var c=new Date(AllUnitsLatestHistory[b].Status.reportTime);if(!AllUnitsLatestHistory[b].Location.lat&&!AllUnitsLatestHistory[b].Location["long"])return 1==AllUnitsLatestHistory.lenght&&(fitBoundsToUSZip(MainPageMap,""),noGPS=!0),void setTimeout(function(){var d=MainPageMap.getCenter(),e=new google.maps.InfoWindow({content:'<div class="noGPSInfo"><p>'+AllUnitsLatestHistory[b].Information.name+",</p><p>"+c.toLocaleString()+'</p><p style="color: red">GPS data not available</p></div>',position:d,pixelOffset:new google.maps.Size(5*a,5*a++)});a++,MVInfoWindows.push(e),google.maps.event.addListener(e,"domready",function(){var a=$(".noGPSInfo").parents(".gm-style-iw");a.prev();a.parent().addClass("noGPSInfoWrapper"),$(".noGPSInfoWrapper").children("div:first-child").children("div:nth-child(3)").hide(),$(".noGPSInfoWrapper").children("div:first-child").children("div:first-child").hide()})},500);var d=new google.maps.LatLng(AllUnitsLatestHistory[b].Location.lat,AllUnitsLatestHistory[b].Location["long"]),e="";e=MapDeviceStateToMapMarkers(AllUnitsLatestHistory[b].Status.deviceState);var f=new google.maps.Marker({position:d,map:MainPageMap,icon:e,title:AllUnitsLatestHistory[b].Information.name+"\n"+MapDeviceStateToUserText(AllUnitsLatestHistory[b].Status.deviceState)+"\n"+c.toLocaleString()}),g=function(){return function(){MainPageMapMarkers.push(f),function(){var a=MainPageMapBounds.extend(d);MainPageMap.fitBounds(a);var b=a.getCenter(),c=Apperyio("MainPageMapComponent");c.options.latitude=b.lat(),c.options.longitude=b.lng(),lazySetZoom()}()}};f.addListener("click",function(){localStorage.setItem("currentDeviceSn",AllUnitsLatestHistory[b].Information.whrztSn),Apperyio.navigateTo("TrailerStatus")}),setTimeout(g(),1)}};for(i=0;i<AllUnitsLatestHistory.length;i++)b(i)}function removeInfoWindows(){for(var a=0;a<MVInfoWindows.length;a++)MVInfoWindows[a].setMap(null)}function ShowAllTrailers(){_.each(MainPageMapMarkers,function(a){var b=MainPageMapBounds.extend(a.position);MainPageMap.fitBounds(b),lazySetZoom()})}function filterInit(){$(".MainPageListClass").filterable("option","filterCallback",function(a,b){var c=!1;if(MainPageMapMarkers[a]&&MainPageMapMarkers[a].setMap(MainPageMap),a==AllUnitsLatestHistory.length)return!0;var d=AllUnitsLatestHistory[a];if(b){var e=new Date(d.Status.reportTime).toLocaleString();-1===d.Information.name.toLowerCase().indexOf(b)&&-1===d.Status.deviceState.toLowerCase().indexOf(b)&&-1===e.indexOf(b)&&(c=!0,MainPageMapMarkers[a].setMap(null))}return c})}function updateGeoFencesDataWithDataSource(a,b,c){for(var d=0;d<b.length;d++)b[d].setMap(null);for(b=[],d=0;d<c.length;d++)c[d].setMap(null);c=[],a&&a.execute()}function refreshGeoFencesForMap(a,b,c,d){_.each(a,function(a){var e=new google.maps.LatLng(a.lat,a["long"]),f=new google.maps.Marker({position:e,map:b,title:a.name+":\n"+a.type,animation:google.maps.Animation.DROP,zIndex:2});c.push(f);var g=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:b,center:e,editable:!1,radius:+a.radius||1e3});d.push(g)}),noGPS=!1}var AllUnitsLatestHistory=[],AllUnitsLatestHistoryIndex=AllUnitsDateIndex=AllUnitsStateIndex=0,AllUnitsUpdateTimeout,MainPageMap,MainPageMapBounds=new google.maps.LatLngBounds,previousMapZoom,MainPageMapMarkers=[],MVGFmarkers=[],MVGFcircles=[],MVInfoWindows=[],mapDeferred=$.Deferred(),mapReady=mapDeferred.promise(),noGPS,lazySetZoom=_.debounce(function(){MainPageMap.getZoom()>12&&MainPageMap.setZoom(12)},300);