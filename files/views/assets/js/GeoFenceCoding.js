function initializeGeoFenceMap(){+localStorage.getItem("CurrentSelectedTrailerCarl");GeoFenceMap=Apperyio("GeoFencePageMap").gmap,GeoFenceMap?(GeoFenceMapDeferred.resolve(),GFdeleteMarkers(),ConvertAddressResult=[],drawingManager&&drawingManager.setMap(null),drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.HAND,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.CIRCLE]},circleOptions:{fillColor:"#ff0000",fillOpacity:.1,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,clickable:!1,editable:!0,zIndex:1}}),drawingManager.setMap(GeoFenceMap),google.maps.event.addListener(drawingManager,"circlecomplete",function(a){var b=a.getCenter(),c=a.getRadius();if(GFcircles.push(a),500>c){var d="Minimum radius for GeoFences is approximately 0.3 miles";Appery("GeofenceBottomError").text(d).show(),setTimeout(function(){Appery("GeofenceBottomError").hide("close")},1e4)}GFaddFromMap(b,c,a),circleRadiusChanged(a),drawingManager.setOptions({drawingMode:google.maps.drawing.OverlayType.HAND})}),Apperyio("InputAddressField").val("")):setGeoFenceMapInitDelay()}function setGeoFenceMapInitDelay(){setTimeout(initializeGeoFenceMap,50)}function GeoFenceMap_setCenter_wrapper(a,b){var c=Apperyio("GeoFencePageMap");c.options.latitude="function"==typeof a.lat?a.lat():a.lat,c.options.longitude="function"==typeof a.lng?a.lng():a.lng,GeoFenceMap.setCenter(a)}function UpdateGFsOnMap(){currentAddress=inputedAddress.address,ConvertAddressResult={},GeoCodeAddressToLatLong.execute({data:{address:currentAddress,sensor:!1}})}function ConvertAddress_success(a){return a.results.length?(ConvertAddressResult=a.results[0].geometry.location,inputedAddress.lat=ConvertAddressResult.lat,inputedAddress["long"]=ConvertAddressResult.lng,void(localStorage.selectedGeoFence?geofenceUpdate.execute():geofenceAdd.execute())):(localStorage.GFErrorText="WHRZT: Address "+currentAddress+" not recognized, please re-enter",Apperyio.navigateTo("GeoFenceError"),void(localStorage.selectedGeoFence&&geofenceUpdate.execute()))}function placeMarker(a){var b=new google.maps.LatLng(a.lat,a["long"]||0),c=new google.maps.Marker({position:b,map:GeoFenceMap,title:a.name+":\n"+a.type,animation:google.maps.Animation.DROP,zIndex:2});c.addListener("click",function(){var a=GFmarkers.indexOf(this);currentGeofence=GFallTrailers[localStorage.CurrentSelectedTrailerCarl][a],localStorage.selectedGeoFence=currentGeofence.geoFenceID,Appery("InputAddressField").val(currentGeofence.address),Appery("GeoFenceNameInput").val(currentGeofence.name),$("input[value="+currentGeofence.type+"]").prop("checked",!0),$("input[name=GeoFenceEnterExitRadio]").checkboxradio("refresh")}),GFmarkers.push(c),GFmapBounds.extend(b)}function placeCircle(a){var b=new google.maps.LatLng(+a.lat,+a["long"]||0),c=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:GeoFenceMap,center:b,editable:!0,radius:+a.radius||1e3});circleRadiusChanged(c),GFcircles.push(c),GFshowMarkers(),GFmap_calculateAndSetBounds(),GeoFenceMap_setCenter_wrapper(GFmapBounds.getCenter())}function GFmap_calculateAndSetBounds(){return GFmapBounds=new google.maps.LatLngBounds,_.each(GFmarkers,function(a){GFmapBounds.extend(a.position)}),GeoFenceMap.fitBounds(GFmapBounds),GeoFenceMap.getZoom()>12&&GeoFenceMap.setZoom(12),GFmapBounds.getCenter()}function GFsetAllMap(a){for(var b=0;b<GFmarkers.length;b++)GFmarkers[b].setMap(a);for(var c=0;c<GFcircles.length;c++)GFcircles[c].setMap(a)}function GFshowMarkers(){GFsetAllMap(GeoFenceMap)}function GFclearMarkers(){GFsetAllMap(null)}function GFdeleteMarkers(){GFclearMarkers(),GFmarkers=[],GFcircles=[]}function saveGF(){var a=Apperyio("InputAddressField").val(),b=Apperyio("GeoFenceNameInput").val(),c=$("[name='GeoFenceEnterExitRadio']:checked").val();a&&b&&(inputedAddress={address:a,name:b,type:c},UpdateGFsOnMap())}function deleteGF(){var a=+localStorage.getItem("selectedGeoFence"),b=+localStorage.getItem("CurrentSelectedTrailerCarl"),c=_.indexOf(GFallTrailers[b],{geoFenceId:a});if(c||0===c){GFmarkers[c+1].setMap(null),GFmarkers.splice(c+1,1),GFcircles[c+1].setMap(null),GFcircles.splice(c+1,1);var d=GFmap_calculateAndSetBounds();GeoFenceMap_setCenter_wrapper(d)}}function fillGFList(){GFdeleteMarkers();var a=+localStorage.getItem("CurrentSelectedTrailerCarl");_.each(GFallTrailers[a],function(a){placeMarker(a),placeCircle(a)})}function GFaddFromMap(a,b,c){var d=new google.maps.Geocoder;d.geocode({latLng:a},function(c,d){if(d==google.maps.GeocoderStatus.OK){var e=c[0].formatted_address;inputedAddress.address=e,inputedAddress.radius=500>b?500:b,inputedAddress.name="From Map",inputedAddress.type=$("[name='GeoFenceEnterExitRadio']:checked").val(),inputedAddress.lat=a.lat(),inputedAddress["long"]=a.lng(),geofenceAdd.execute()}})}function circleRadiusChanged(a){google.maps.event.addListener(a,"radius_changed",function(){var b=localStorage.getItem("CurrentSelectedTrailerCarl"),c=GFcircles.indexOf(a);GFallTrailers[b][c].radius=a.getRadius(),currentGeofence=GFallTrailers[b][c],localStorage.selectedGeoFence=currentGeofence.geoFenceID,geofenceUpdate.execute()}),google.maps.event.addListener(a,"center_changed",function(){var b=localStorage.getItem("CurrentSelectedTrailerCarl"),c=GFcircles.indexOf(a),d=a.getCenter(),e=new google.maps.Geocoder;GFallTrailers[b][c].radius=a.getRadius(),currentGeofence=GFallTrailers[b][c],localStorage.selectedGeoFence=currentGeofence.geoFenceID,e.geocode({latLng:d},function(a,b){if(b==google.maps.GeocoderStatus.OK){var c=a[0].formatted_address;inputedAddress.address=c,inputedAddress.lat=d.lat(),inputedAddress["long"]=d.lng(),geofenceUpdate.execute()}})})}var GeoFenceMap,GFallTrailers=[],inputedAddress={},currentAddress,GFmapBounds=new google.maps.LatLngBounds,drawingManager,currentGeofence,GFmarkers=[],GFcircles=[],geofenceListTimeout,GeoFenceMapDeferred=$.Deferred(),GeoFenceMapReady=GeoFenceMapDeferred.promise(),ConvertAddressCount,ConvertAddressReady;